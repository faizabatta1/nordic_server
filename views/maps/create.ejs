<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Map</title>
    <link href="https://cdn.jsdelivr.xyz/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .live-preview {
        width: 50px;
        height: 50px;
        border: 1px solid #ccc;
        margin: 10px 0;
      }

      #map {
        width: 100%;
        height: 300px;
      }
    </style>
</head>
<body>
  <%- include('../components/navbar.ejs') %>

    <div class="container">
        <h1 class="mt-4">Create Map</h1>
        <div>
            <div class="mb-3">
                <label for="color" class="form-label">Color</label>
                <input type="text" id="color" name="color" class="form-control" required>
                <div class="live-preview" id="colorPreview"></div>
            </div>
            <div class="mb-3">
                <label for="data" class="form-label">Data</label>
                <input type="text" id="data" name="data" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="type" class="form-label">Type</label>
                <input type="text" id="type" name="type" class="form-control" required>
            </div>
            <div id="map"></div>
            <div class="d-flex justify-content-center align-items-center mt-3">
              <button class="btn btn-primary me-3 ps-3 pe-3" id="createButton">Create</button>
              <a href="/maps" class="btn btn-secondary ps-3 pe-3">Cancel</a>
            </div>
          </div>
    </div>

    <script src="https://cdn.jsdelivr.xyz/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>
    <script>
      // Google Maps
      const map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 0, lng: 0 },
        zoom: 2
      });

      // Color live preview
      const colorInput = document.getElementById('color');
      const colorPreview = document.getElementById('colorPreview');

      colorInput.addEventListener('input', () => {
        const color = colorInput.value;
        colorPreview.style.backgroundColor = color;
      });

      // Create map
      const createButton = document.getElementById('createButton');

      createButton.addEventListener('click', () => {
        const color = colorInput.value;
        const data = document.getElementById('data').value;
        const type = document.getElementById('type').value;

        // Create a JSON object with the map data
        const newMap = {
          color: color,
          data: data,
          type: type
        };

        // Send a fetch request to create the map
        fetch('/api/maps', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(newMap)
        })
        .then(response => {
          if (response.ok) {
            // Redirect to the maps page after successful creation
            location.href = '/maps';
          } else {
            console.error('Error creating map:', response.statusText);
            // Handle errors here, e.g., display an error message
            alert('Failed to create the map. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          // Display an error message to the user
          alert('An error occurred while creating the map. Please try again later.');
        });
      });
    </script>
</body>
</html>
